{%- comment -%}Loop over the global font config and construct a series of @font-face declarations.
We later feed this to scss to minify the output and inline it in the head for performance.{%- endcomment -%}
{%- assign allFonts = fonts | values -%}
{%- for font in allFonts -%}
  {%- assign weights = font.weights | keys -%}
  {%- for weight in weights -%}
    {%- assign fontEntry = font.weights[weight] -%}
    {%- assign family = font.family -%}
    {%- assign format = fontEntry.url | split: "." | last -%}
    {%- comment -%}Regular-weight fonts follow the convention of "FontFamily" as their local name on the OS.
    All other font weights will be formatted as "FontFamily WeightStyle".{%- endcomment -%}
    {%- assign capitalizedWeight = weight | capitalize -%}
    {%- assign localFontName = family | append: " " | append: capitalizedWeight | replace: " RegularItalic", " Italic" | replace: " Regular", "" -%}
    @font-face {
      font-family: '{{ family }}';
      font-style: {{ fontEntry.style }};
      font-weight: {{ fontEntry.weight }};
      font-display: {{ fontEntry.display }};
      src: local('{{ localFontName }}'), url('{{ fontEntry.url }}') format('{{ format }}');
    }
  {%- endfor -%}
{%- endfor -%}